# How to train Tesseract 4 from CNI tiff/box pairs

## Installation and prerequisites

You must install Tesseract 4 with the training tools.

```
make training
sudo make training-install
```

You must download `eng` and `common` tesseract training data in the `/training/langdata` folder.

It is recommended to install `jTessBoxEditor`.

## Pipeline

The `pipeline.sh` bash script is enough to fine-tune the neural network.

It runs the following steps :

* Reset temp directory
* Add tif/box pairs to lang data
* Generate training data (lstmf files)
* Generate list of wanted lstmf files (we only train of the tiff/box pairs, not on artificial data generated by the previous script)
* Extract english neural network weights
* Train: fine-tune english neural network weights with our tiff/box pairs
* Once the network has converged, pack the weights
* Copy english trained data
* Replace old english weights with fine-tuned ones
* Copy the generated traineddata to the `api` folder.
* System-install new lang data "franceocr"

## Utilities

Two utility scripts are provided.

### `make_box.py`

`make_box.py` is a Python script which helps bootstrap box files.

Provided a tiff image of a string, the x-coordinate of the first letter and the string, the script generates a box file associated to the tiff. It generally requires manual modifications of the box file with `jTessBoxEditor` to better fit the individual letters.

### `box_editor.sh`

`box_editor.sh` is a simple script which launches `jTessBoxEditor`.

It expects the binary to sit in a sibling folder of this repository.

`jTessBoxEditor` is a graphical tool to edit box files.
